{% extends 'base.html' %}

{% block title %}{{ title }} - AdminiRed{% endblock %}

{% block content %}
<div class="section">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
        <h2><i class="fas fa-calendar-check"></i> {{ title }}</h2>
        <a href="{% url 'pagos:plan_pago_list' %}" class="btn btn-secondary">
            <i class="fas fa-arrow-left"></i> Volver
        </a>
    </div>
    
    <div style="background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); max-width: 800px; margin: 0 auto;">
        <form method="post">
            {% csrf_token %}
            
            {% if instalacion_pre_seleccionada %}
            <div style="background: #e0e7ff; padding: 1rem; border-radius: 8px; margin-bottom: 1.5rem; border: 1px solid #667eea;">
                <p style="margin: 0; color: #667eea; font-weight: 600;">
                    <i class="fas fa-info-circle"></i> Instalación pre-seleccionada: <strong>{{ instalacion_pre_seleccionada.numero_contrato }}</strong> - {{ instalacion_pre_seleccionada.cliente.nombre_completo }}
                </p>
            </div>
            {% endif %}
            
            <div style="margin-bottom: 1.5rem;">
                <label for="{{ form.instalacion.id_for_label }}" style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #374151;">
                    <i class="fas fa-network-wired"></i> Instalación <span style="color: #ef4444;">*</span>
                </label>
                {{ form.instalacion }}
                {% if form.instalacion.errors %}
                    <div style="color: #ef4444; font-size: 0.875rem; margin-top: 0.25rem;">{{ form.instalacion.errors }}</div>
                {% endif %}
                <small style="color: #6b7280; font-size: 0.875rem; display: block; margin-top: 0.25rem;">
                    Solo se muestran instalaciones activas que no tienen plan de pago asignado.
                </small>
            </div>
            
            <div style="margin-bottom: 1.5rem;">
                <label for="{{ form.monto_mensual.id_for_label }}" style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #374151;">
                    <i class="fas fa-dollar-sign"></i> Monto Mensual <span style="color: #ef4444;">*</span>
                </label>
                {{ form.monto_mensual }}
                {% if form.monto_mensual.errors %}
                    <div style="color: #ef4444; font-size: 0.875rem; margin-top: 0.25rem;">{{ form.monto_mensual.errors }}</div>
                {% endif %}
                <small style="color: #6b7280; font-size: 0.875rem; display: block; margin-top: 0.25rem;">
                    Monto que se cobrará cada mes.
                </small>
            </div>
            
            <div style="margin-bottom: 1.5rem;">
                <label for="{{ form.dia_vencimiento.id_for_label }}" style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #374151;">
                    <i class="fas fa-calendar-day"></i> Día de Vencimiento <span style="color: #ef4444;">*</span>
                </label>
                {{ form.dia_vencimiento }}
                {% if form.dia_vencimiento.errors %}
                    <div style="color: #ef4444; font-size: 0.875rem; margin-top: 0.25rem;">{{ form.dia_vencimiento.errors }}</div>
                {% endif %}
                <small style="color: #6b7280; font-size: 0.875rem; display: block; margin-top: 0.25rem;">
                    Día del mes en que vence el pago (1-31). Si el mes tiene menos días, se ajustará automáticamente.
                </small>
            </div>
            
            <div style="margin-bottom: 1.5rem;">
                <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                    {{ form.activo }}
                    <span style="font-weight: 600; color: #374151;">{{ form.activo.label }}</span>
                </label>
                {% if form.activo.errors %}
                    <div style="color: #ef4444; font-size: 0.875rem; margin-top: 0.25rem;">{{ form.activo.errors }}</div>
                {% endif %}
                <small style="color: #6b7280; font-size: 0.875rem; display: block; margin-top: 0.25rem;">
                    Solo los planes activos generarán pagos automáticamente.
                </small>
            </div>
            
            <div style="background: #f0fdf4; border-left: 4px solid #10b981; padding: 1rem; border-radius: 8px; margin-bottom: 1.5rem;">
                <p style="margin: 0; color: #166534; font-size: 0.875rem;">
                    <strong><i class="fas fa-lightbulb"></i> Tip:</strong> Después de crear el plan, puedes generar pagos automáticamente usando el comando:
                    <code style="background: white; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.8rem;">python manage.py generar_pagos</code>
                </p>
            </div>
            
            <div style="display: flex; gap: 1rem; justify-content: flex-end; margin-top: 2rem;">
                <a href="{% url 'pagos:plan_pago_list' %}" class="btn btn-secondary">
                    <i class="fas fa-times"></i> Cancelar
                </a>
                <button type="submit" class="btn" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                    <i class="fas fa-save"></i> Guardar
                </button>
            </div>
        </form>
    </div>
</div>
{% endblock %}

