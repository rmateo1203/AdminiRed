{% extends 'base.html' %}
{% load static %}

{% block title %}Inicio - {{ sistema_config.nombre_empresa|default:"AdminiRed" }}{% endblock %}

{% block extra_css %}
<style>
    .hero-section {
        position: relative;
        width: 100%;
        height: 400px;
        overflow: hidden;
        border-radius: 15px;
        margin-bottom: 2rem;
        box-shadow: 0 4px 20px rgba(0,0,0,0.15);
    }
    
    .hero-image {
        width: 100%;
        height: 100%;
        object-fit: cover;
        object-position: center;
    }
    
    .hero-overlay {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(135deg, rgba(102, 126, 234, 0.85) 0%, rgba(118, 75, 162, 0.85) 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: column;
        color: white;
        text-align: center;
        padding: 2rem;
    }
    
    .hero-title {
        font-size: 2.5rem;
        font-weight: 700;
        margin-bottom: 1rem;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }
    
    .hero-subtitle {
        font-size: 1.2rem;
        opacity: 0.95;
        max-width: 600px;
    }
    
    @media (max-width: 768px) {
        .hero-section {
            height: 300px;
        }
        
        .hero-title {
            font-size: 1.8rem;
        }
        
        .hero-subtitle {
            font-size: 1rem;
        }
    }
    
    @media (max-width: 480px) {
        .hero-section {
            height: 250px;
        }
        
        .hero-title {
            font-size: 1.5rem;
        }
        
        .hero-subtitle {
            font-size: 0.9rem;
        }
    }
</style>
{% endblock %}

{% block content %}
<!-- Hero Section con Imagen Configurable -->
<div class="hero-section">
    {% if sistema_config.imagen_hero %}
        <img 
            src="{{ sistema_config.imagen_hero.url }}?v={{ sistema_config.fecha_actualizacion|date:'U' }}" 
            alt="{{ sistema_config.nombre_empresa|default:'AdminiRed' }}" 
            class="hero-image"
            loading="lazy"
            onerror="this.onerror=null; this.src='https://images.unsplash.com/photo-1558618666-fcd25c85cd64?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2070&q=80';"
        >
    {% else %}
        {% comment %}
        Imagen por defecto si no hay imagen configurada
        {% endcomment %}
        <img 
            src="https://images.unsplash.com/photo-1558618666-fcd25c85cd64?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2070&q=80" 
            alt="Torres de telecomunicaciones e internet" 
            class="hero-image"
            loading="lazy"
            onerror="this.style.background='linear-gradient(135deg, var(--color-primario) 0%, var(--color-secundario) 100%)'; this.style.display='none';"
        >
    {% endif %}
    <div class="hero-overlay">
        <h1 class="hero-title">{{ sistema_config.nombre_empresa|default:"AdminiRed" }}</h1>
        <p class="hero-subtitle">{{ sistema_config.descripcion_sistema|default:"Sistema para el control total de instalaciones de internet" }}</p>
    </div>
</div>

<div class="stats-grid">
    <!-- Estadísticas de Clientes -->
    <div class="stat-card">
        <h3>Total Clientes</h3>
        <div class="value">{{ total_clientes }}</div>
        <div class="subtitle">{{ clientes_activos }} activos</div>
    </div>
    
    <div class="stat-card">
        <h3>Clientes Nuevos</h3>
        <div class="value">{{ clientes_nuevos_mes }}</div>
        <div class="subtitle">Últimos 30 días</div>
    </div>
    
    <!-- Estadísticas de Instalaciones -->
    <div class="stat-card">
        <h3>Instalaciones</h3>
        <div class="value">{{ instalaciones_activas }}</div>
        <div class="subtitle">de {{ total_instalaciones }} totales</div>
    </div>
    
    <div class="stat-card">
        <h3>Pendientes</h3>
        <div class="value">{{ instalaciones_pendientes }}</div>
        <div class="subtitle">{{ instalaciones_programadas }} programadas</div>
    </div>
    
    <!-- Estadísticas de Pagos -->
    <div class="stat-card">
        <h3>Pagos Pendientes</h3>
        <div class="value">{{ pagos_pendientes }}</div>
        <div class="subtitle">{{ pagos_vencidos }} vencidos</div>
    </div>
    
    <!-- Estadísticas de Inventario -->
    <div class="stat-card">
        <h3>Materiales</h3>
        <div class="value">{{ total_materiales }}</div>
        <div class="subtitle">
            {% if materiales_bajo_stock > 0 %}
                <span style="color: #f59e0b;">{{ materiales_bajo_stock }} bajo stock</span>
            {% else %}
                Stock normal
            {% endif %}
        </div>
    </div>
    
    <div class="stat-card">
        <h3>Notificaciones</h3>
        <div class="value">{{ notificaciones_pendientes }}</div>
        <div class="subtitle">{{ notificaciones_hoy }} enviadas hoy</div>
    </div>
</div>

<!-- Alertas -->
{% if pagos_vencidos > 0 %}
<div class="alert alert-danger">
    <strong>⚠️ Atención:</strong> Tienes {{ pagos_vencidos }} pago(s) vencido(s) que requieren atención.
</div>
{% endif %}

{% if materiales_agotados > 0 %}
<div class="alert alert-warning">
    <strong>⚠️ Inventario:</strong> Tienes {{ materiales_agotados }} material(es) agotado(s) en inventario.
</div>
{% endif %}

{% if materiales_bajo_stock > 0 %}
<div class="alert alert-warning">
    <strong>⚠️ Inventario:</strong> Tienes {{ materiales_bajo_stock }} material(es) con stock bajo.
</div>
{% endif %}

<!-- Próximos Vencimientos -->
<div class="section">
    <div class="page-header" style="border-bottom: 2px solid #f0f0f0; padding-bottom: 1rem; margin-bottom: 1.5rem;">
        <h2 style="margin: 0; font-size: 1.5rem;"><i class="fas fa-calendar-alt"></i> Próximos Vencimientos (Próximos 7 días)</h2>
        <a href="{% url 'pagos:pago_list' %}" class="btn btn-secondary">
            <i class="fas fa-list"></i> Ver Todos
        </a>
    </div>
    {% if proximos_vencimientos %}
    <div class="table-wrapper">
        <div class="table-responsive">
            <table class="table-modern">
                <thead>
                    <tr>
                        <th style="width: 25%; min-width: 180px;">Cliente</th>
                        <th style="width: 25%; min-width: 150px;">Concepto</th>
                        <th style="width: 15%; min-width: 100px;">Monto</th>
                        <th style="width: 20%; min-width: 130px;">Fecha Vencimiento</th>
                        <th style="width: 15%; min-width: 100px;">Estado</th>
                    </tr>
                </thead>
                <tbody>
                    {% for pago in proximos_vencimientos %}
                    <tr>
                        <td>
                            <span class="client-name" style="display: block; font-weight: 600; color: #1f2937; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                                {{ pago.cliente.nombre_completo }}
                            </span>
                        </td>
                        <td>
                            <span style="overflow: hidden; text-overflow: ellipsis; white-space: nowrap; display: block;">{{ pago.concepto }}</span>
                        </td>
                        <td>
                            <strong style="color: #10b981; white-space: nowrap;">${{ pago.monto|floatformat:2 }}</strong>
                        </td>
                        <td>
                            <span style="white-space: nowrap;">{{ pago.fecha_vencimiento|date:"d/m/Y" }}</span>
                        </td>
                        <td>
                            {% if pago.estado == 'vencido' %}
                                <span class="badge-modern badge-danger-modern">
                                    <i class="fas fa-exclamation-triangle"></i> Vencido
                                </span>
                            {% elif pago.estado == 'pendiente' %}
                                <span class="badge-modern badge-warning-modern">
                                    <i class="fas fa-clock"></i> Pendiente
                                </span>
                            {% else %}
                                <span class="badge-modern badge-info-modern">
                                    {{ pago.get_estado_display }}
                                </span>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% else %}
    <div class="empty-state-modern">
        <i class="fas fa-calendar-check"></i>
        <p>No hay pagos próximos a vencer en los próximos 7 días</p>
    </div>
    {% endif %}
</div>

<!-- Instalaciones Recientes -->
<div class="section">
    <div class="page-header" style="border-bottom: 2px solid #f0f0f0; padding-bottom: 1rem; margin-bottom: 1.5rem;">
        <h2 style="margin: 0; font-size: 1.5rem;"><i class="fas fa-wifi"></i> Instalaciones Recientes</h2>
        <a href="{% url 'instalaciones:instalacion_list' %}" class="btn btn-secondary">
            <i class="fas fa-list"></i> Ver Todas
        </a>
    </div>
    {% if instalaciones_recientes %}
    <div class="table-wrapper">
        <div class="table-responsive">
            <table class="table-modern">
                <thead>
                    <tr>
                        <th style="width: 25%; min-width: 180px;">Cliente</th>
                        <th style="width: 25%; min-width: 150px;">Plan</th>
                        <th style="width: 15%; min-width: 120px;">Velocidad</th>
                        <th style="width: 15%; min-width: 100px;">Estado</th>
                        <th style="width: 20%; min-width: 150px;">Fecha Solicitud</th>
                    </tr>
                </thead>
                <tbody>
                    {% for instalacion in instalaciones_recientes %}
                    <tr>
                        <td>
                            <span class="client-name" style="display: block; font-weight: 600; color: #1f2937; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                                {{ instalacion.cliente.nombre_completo }}
                            </span>
                        </td>
                        <td>
                            <span style="overflow: hidden; text-overflow: ellipsis; white-space: nowrap; display: block;">{{ instalacion.plan_nombre }}</span>
                        </td>
                        <td>
                            <strong style="color: #1f2937; white-space: nowrap;">{{ instalacion.velocidad_descarga }} Mbps</strong>
                            {% if instalacion.velocidad_subida %}
                                <br><small style="color: #6b7280;">↑ {{ instalacion.velocidad_subida }} Mbps</small>
                            {% endif %}
                        </td>
                        <td>
                            {% if instalacion.estado == 'activa' %}
                                <span class="badge-modern badge-success-modern">
                                    <i class="fas fa-check-circle"></i> {{ instalacion.get_estado_display }}
                                </span>
                            {% elif instalacion.estado == 'pendiente' %}
                                <span class="badge-modern badge-warning-modern">
                                    <i class="fas fa-clock"></i> {{ instalacion.get_estado_display }}
                                </span>
                            {% elif instalacion.estado == 'programada' %}
                                <span class="badge-modern badge-info-modern">
                                    <i class="fas fa-calendar-check"></i> {{ instalacion.get_estado_display }}
                                </span>
                            {% else %}
                                <span class="badge-modern badge-danger-modern">
                                    {{ instalacion.get_estado_display }}
                                </span>
                            {% endif %}
                        </td>
                        <td>
                            <span style="white-space: nowrap;">{{ instalacion.fecha_solicitud|date:"d/m/Y" }}</span>
                            <br><small style="color: #6b7280; font-size: 0.875rem;">{{ instalacion.fecha_solicitud|date:"H:i" }}</small>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% else %}
    <div class="empty-state-modern">
        <i class="fas fa-wifi"></i>
        <p>No hay instalaciones recientes</p>
    </div>
    {% endif %}
</div>

<!-- Acciones Rápidas -->
<div class="section">
    <h2>Acciones Rápidas</h2>
    <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
        {% if user.is_authenticated %}
            <a href="{% url 'clientes:cliente_create' %}" class="btn"><i class="fas fa-user-plus"></i> Nuevo Cliente</a>
            <a href="{% url 'instalaciones:instalacion_create' %}" class="btn"><i class="fas fa-wifi"></i> Nueva Instalación</a>
            <a href="/admin/pagos/pago/add/" class="btn"><i class="fas fa-dollar-sign"></i> Registrar Pago</a>
            <a href="/admin/inventario/material/add/" class="btn"><i class="fas fa-boxes"></i> Agregar Material</a>
            <a href="/admin/" class="btn btn-admin"><i class="fas fa-cog"></i> Administración Completa</a>
        {% else %}
            <a href="{% url 'login' %}?next={% url 'clientes:cliente_create' %}" class="btn"><i class="fas fa-user-plus"></i> Nuevo Cliente</a>
            <a href="{% url 'login' %}?next={% url 'instalaciones:instalacion_create' %}" class="btn"><i class="fas fa-wifi"></i> Nueva Instalación</a>
            <a href="{% url 'login' %}?next=/admin/pagos/pago/add/" class="btn"><i class="fas fa-dollar-sign"></i> Registrar Pago</a>
            <a href="{% url 'login' %}?next=/admin/inventario/material/add/" class="btn"><i class="fas fa-boxes"></i> Agregar Material</a>
            <a href="{% url 'login' %}?next=/admin/" class="btn btn-admin"><i class="fas fa-cog"></i> Administración Completa</a>
        {% endif %}
    </div>
    {% if not user.is_authenticated %}
    <p style="margin-top: 1rem; color: #666; font-size: 0.9rem; text-align: center;">
        <strong>Nota:</strong> Debes iniciar sesión para acceder a estas funciones.
    </p>
    {% endif %}
</div>
{% endblock %}

