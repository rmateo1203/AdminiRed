{% extends 'base.html' %}

{% block title %}Lista de Roles - {{ sistema_config.nombre_empresa|default:"AdminiRed" }}{% endblock %}

{% block content %}
<div class="section">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
        <h2><i class="fas fa-users-cog"></i> Roles del Sistema</h2>
        <div style="display: flex; gap: 1rem;">
            <a href="{% url 'core:rol_create' %}" class="btn">
                <i class="fas fa-plus"></i> Crear Rol
            </a>
            <a href="{% url 'core:roles_dashboard' %}" class="btn btn-admin">
                <i class="fas fa-arrow-left"></i> Volver al Dashboard
            </a>
        </div>
    </div>
    
    <!-- Búsqueda y Filtros -->
    <div style="background: white; border-radius: 12px; padding: 1.5rem; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 2rem;">
        <form method="get" style="display: flex; gap: 1rem; flex-wrap: wrap; align-items: end;">
            <div style="flex: 1; min-width: 200px;">
                <label style="display: block; margin-bottom: 0.5rem; color: #6b7280; font-weight: 600;">Búsqueda</label>
                <input type="text" name="q" value="{{ query }}" placeholder="Buscar por nombre, código..." 
                       style="width: 100%; padding: 0.75rem; border: 1px solid #d1d5db; border-radius: 8px;">
            </div>
            <div style="min-width: 150px;">
                <label style="display: block; margin-bottom: 0.5rem; color: #6b7280; font-weight: 600;">Estado</label>
                <select name="estado" style="width: 100%; padding: 0.75rem; border: 1px solid #d1d5db; border-radius: 8px;">
                    <option value="">Todos</option>
                    <option value="activo" {% if estado_filter == 'activo' %}selected{% endif %}>Activos</option>
                    <option value="inactivo" {% if estado_filter == 'inactivo' %}selected{% endif %}>Inactivos</option>
                </select>
            </div>
            <div>
                <button type="submit" class="btn">
                    <i class="fas fa-search"></i> Buscar
                </button>
            </div>
        </form>
    </div>
    
    <!-- Tabla de Roles -->
    <div style="background: white; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); overflow: hidden;">
        <table class="table">
            <thead>
                <tr>
                    <th>Nombre</th>
                    <th>Código</th>
                    <th>Permisos</th>
                    <th>Usuarios</th>
                    <th>Estado</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                {% for rol in page_obj %}
                <tr>
                    <td>
                        <div style="font-weight: 600; color: #111827;">{{ rol.nombre }}</div>
                        {% if rol.descripcion %}
                        <div style="color: #6b7280; font-size: 0.875rem; margin-top: 0.25rem;">{{ rol.descripcion|truncatewords:10 }}</div>
                        {% endif %}
                    </td>
                    <td><code style="background: #f3f4f6; padding: 0.25rem 0.5rem; border-radius: 4px;">{{ rol.codigo }}</code></td>
                    <td>
                        <span style="color: #10b981; font-weight: 600;">{{ rol.cantidad_permisos }}</span>
                    </td>
                    <td>
                        <span style="color: #3b82f6; font-weight: 600;">{{ rol.cantidad_usuarios }}</span>
                    </td>
                    <td>
                        {% if rol.activo %}
                        <span style="background: #d1fae5; color: #065f46; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.875rem; font-weight: 600;">Activo</span>
                        {% else %}
                        <span style="background: #fee2e2; color: #991b1b; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.875rem; font-weight: 600;">Inactivo</span>
                        {% endif %}
                    </td>
                    <td>
                        <a href="{% url 'core:rol_detail' rol.pk %}" class="btn btn-action" title="Ver detalle">
                            <i class="fas fa-eye"></i>
                        </a>
                        <a href="{% url 'core:rol_update' rol.pk %}" class="btn btn-action" title="Editar" style="background: #f59e0b;">
                            <i class="fas fa-edit"></i>
                        </a>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="6" style="text-align: center; padding: 3rem; color: #6b7280;">
                        No se encontraron roles.
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    
    <!-- Paginación -->
    {% if page_obj.has_other_pages %}
    <div class="pagination-modern">
        {% if page_obj.has_previous %}
            <a href="?page=1{% if query %}&q={{ query }}{% endif %}{% if estado_filter %}&estado={{ estado_filter }}{% endif %}">« Primera</a>
            <a href="?page={{ page_obj.previous_page_number }}{% if query %}&q={{ query }}{% endif %}{% if estado_filter %}&estado={{ estado_filter }}{% endif %}">‹ Anterior</a>
        {% endif %}
        <span class="current">
            Página {{ page_obj.number }} de {{ page_obj.paginator.num_pages }}
        </span>
        {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}{% if query %}&q={{ query }}{% endif %}{% if estado_filter %}&estado={{ estado_filter }}{% endif %}">Siguiente ›</a>
            <a href="?page={{ page_obj.paginator.num_pages }}{% if query %}&q={{ query }}{% endif %}{% if estado_filter %}&estado={{ estado_filter }}{% endif %}">Última »</a>
        {% endif %}
    </div>
    {% endif %}
    
</div>
{% endblock %}

