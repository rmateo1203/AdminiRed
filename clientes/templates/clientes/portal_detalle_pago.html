{% extends 'clientes/portal_base.html' %}
{% load static %}

{% block page_title %}Detalle de Pago{% endblock %}

{% block portal_content %}
<div class="row">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header" style="background-color: var(--primary-color); color: white;">
                <h5 class="mb-0"><i class="fas fa-money-bill-wave"></i> Detalle del Pago</h5>
            </div>
            <div class="card-body">
                <dl class="row">
                    <dt class="col-sm-4">Concepto:</dt>
                    <dd class="col-sm-8">{{ pago.concepto }}</dd>
                    
                    <dt class="col-sm-4">Monto:</dt>
                    <dd class="col-sm-8"><strong>${{ pago.monto|floatformat:2 }}</strong></dd>
                    
                    <dt class="col-sm-4">Estado:</dt>
                    <dd class="col-sm-8">
                        {% if pago.estado == 'pagado' %}
                            <span class="badge bg-success">{{ pago.get_estado_display }}</span>
                        {% elif pago.estado == 'vencido' %}
                            <span class="badge bg-danger">{{ pago.get_estado_display }}</span>
                        {% elif pago.estado == 'pendiente' %}
                            <span class="badge bg-warning">{{ pago.get_estado_display }}</span>
                        {% else %}
                            <span class="badge bg-secondary">{{ pago.get_estado_display }}</span>
                        {% endif %}
                    </dd>
                    
                    <dt class="col-sm-4">Fecha de Vencimiento:</dt>
                    <dd class="col-sm-8">{{ pago.fecha_vencimiento|date:"d/m/Y" }}</dd>
                    
                    {% if pago.fecha_pago %}
                    <dt class="col-sm-4">Fecha de Pago:</dt>
                    <dd class="col-sm-8">{{ pago.fecha_pago|date:"d/m/Y H:i" }}</dd>
                    {% endif %}
                    
                    {% if pago.instalacion %}
                    <dt class="col-sm-4">Servicio:</dt>
                    <dd class="col-sm-8">{{ pago.instalacion.plan_nombre }}</dd>
                    {% endif %}
                    
                    {% if pago.metodo_pago %}
                    <dt class="col-sm-4">Método de Pago:</dt>
                    <dd class="col-sm-8">{{ pago.get_metodo_pago_display }}</dd>
                    {% endif %}
                    
                    {% if pago.referencia_pago %}
                    <dt class="col-sm-4">Referencia:</dt>
                    <dd class="col-sm-8">{{ pago.referencia_pago }}</dd>
                    {% endif %}
                </dl>
                
                {% if pago.estado == 'pendiente' or pago.estado == 'vencido' %}
                    <div class="alert alert-warning mt-3">
                        <i class="fas fa-exclamation-triangle"></i> Este pago está pendiente. Puedes pagarlo en línea.
                    </div>
                    {% if tiene_pasarela %}
                        <a href="{% url 'pagos:pago_procesar_online' pk=pago.pk %}" class="btn btn-primary btn-lg">
                            <i class="fas fa-credit-card"></i> Pagar en Línea
                        </a>
                    {% else %}
                        <p class="text-muted">Las pasarelas de pago no están configuradas. Por favor, contacta con el administrador.</p>
                    {% endif %}
                {% endif %}
            </div>
        </div>
        
        <!-- Transacciones -->
        {% if transacciones %}
        <div class="card mt-4">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-history"></i> Historial de Transacciones</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-sm">
                        <thead>
                            <tr>
                                <th>Fecha</th>
                                <th>Pasarela</th>
                                <th>Estado</th>
                                <th>Monto</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for transaccion in transacciones %}
                            <tr>
                                <td>{{ transaccion.fecha_creacion|date:"d/m/Y H:i" }}</td>
                                <td>{{ transaccion.get_pasarela_display }}</td>
                                <td>
                                    {% if transaccion.estado == 'completada' %}
                                        <span class="badge bg-success">{{ transaccion.get_estado_display }}</span>
                                    {% elif transaccion.estado == 'pendiente' %}
                                        <span class="badge bg-warning">{{ transaccion.get_estado_display }}</span>
                                    {% elif transaccion.estado == 'fallida' %}
                                        <span class="badge bg-danger">{{ transaccion.get_estado_display }}</span>
                                    {% else %}
                                        <span class="badge bg-secondary">{{ transaccion.get_estado_display }}</span>
                                    {% endif %}
                                </td>
                                <td>${{ transaccion.monto|floatformat:2 }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
    
    <div class="col-md-4">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">Acciones</h5>
            </div>
            <div class="card-body">
                <a href="{% url 'clientes:portal_mis_pagos' %}" class="btn btn-outline-secondary w-100 mb-2">
                    <i class="fas fa-arrow-left"></i> Volver a Mis Pagos
                </a>
                <a href="{% url 'clientes:portal_dashboard' %}" class="btn btn-outline-primary w-100">
                    <i class="fas fa-home"></i> Ir al Dashboard
                </a>
            </div>
        </div>
    </div>
</div>
{% endblock %}




