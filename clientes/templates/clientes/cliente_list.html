{% extends 'base.html' %}

{% block title %}Clientes - AdminiRed{% endblock %}

{% block content %}
<div class="section">
    <div class="section-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; flex-wrap: wrap; gap: 1rem;">
        <h2><i class="fas fa-users"></i> Lista de Clientes</h2>
        <a href="{% url 'clientes:cliente_create' %}" class="btn"><i class="fas fa-plus"></i> Nuevo Cliente</a>
    </div>
    
    <!-- BÃºsqueda y Filtros -->
    <div class="search-filters">
        <form method="get" class="search-form">
            <input 
                type="text" 
                name="q" 
                value="{{ query }}" 
                placeholder="Buscar por nombre, telÃ©fono, email o ciudad..."
                class="form-control"
            >
            <select name="estado" class="form-control">
                <option value="">Todos los estados</option>
                {% for estado_code, estado_name in estados %}
                    <option value="{{ estado_code }}" {% if estado_filter == estado_code %}selected{% endif %}>
                        {{ estado_name }}
                    </option>
                {% endfor %}
            </select>
            <select name="orden" class="form-control">
                <option value="-fecha_registro" {% if orden == '-fecha_registro' %}selected{% endif %}>MÃ¡s recientes</option>
                <option value="fecha_registro" {% if orden == 'fecha_registro' %}selected{% endif %}>MÃ¡s antiguos</option>
                <option value="nombre" {% if orden == 'nombre' %}selected{% endif %}>Apellido A-Z</option>
                <option value="-nombre" {% if orden == '-nombre' %}selected{% endif %}>Apellido Z-A</option>
            </select>
            <button type="submit" class="btn">ğŸ” Buscar</button>
            {% if query or estado_filter %}
                <a href="{% url 'clientes:cliente_list' %}" class="btn btn-secondary">Limpiar</a>
            {% endif %}
        </form>
    </div>
    
    <!-- Tabla de Clientes -->
    {% if page_obj %}
    <div class="table-responsive">
        <table class="table data-table">
            <thead>
                <tr>
                    <th>Nombre</th>
                    <th>TelÃ©fono</th>
                    <th class="hide-mobile">Email</th>
                    <th class="hide-mobile">Ciudad</th>
                    <th>Estado</th>
                    <th class="hide-mobile">Fecha</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                {% for cliente in page_obj %}
                <tr>
                    <td>
                        <strong>{{ cliente.nombre_completo }}</strong>
                        <span class="mobile-only" style="display: block; font-size: 0.8rem; color: #666;">{{ cliente.ciudad }}</span>
                    </td>
                    <td>
                        <a href="tel:{{ cliente.telefono }}" style="color: #667eea; text-decoration: none;">{{ cliente.telefono }}</a>
                    </td>
                    <td class="hide-mobile">{{ cliente.email|default:"â€”" }}</td>
                    <td class="hide-mobile">{{ cliente.ciudad }}</td>
                    <td>
                        {% if cliente.estado_cliente == 'activo' %}
                            <span class="badge badge-success">{{ cliente.get_estado_cliente_display }}</span>
                        {% elif cliente.estado_cliente == 'inactivo' %}
                            <span class="badge badge-info">{{ cliente.get_estado_cliente_display }}</span>
                        {% elif cliente.estado_cliente == 'suspendido' %}
                            <span class="badge badge-warning">{{ cliente.get_estado_cliente_display }}</span>
                        {% else %}
                            <span class="badge badge-danger">{{ cliente.get_estado_cliente_display }}</span>
                        {% endif %}
                    </td>
                    <td class="hide-mobile">{{ cliente.fecha_registro|date:"d/m/Y" }}</td>
                    <td>
                        <div style="display: flex; gap: 0.25rem; flex-wrap: wrap;">
                            <a href="{% url 'clientes:cliente_detail' cliente.pk %}" class="btn btn-action" title="Ver"><i class="fas fa-eye"></i></a>
                            <a href="{% url 'clientes:cliente_update' cliente.pk %}" class="btn btn-secondary btn-action" title="Editar"><i class="fas fa-edit"></i></a>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    
    <!-- PaginaciÃ³n -->
    {% if page_obj.has_other_pages %}
    <div class="pagination">
        {% if page_obj.has_previous %}
            <a href="?page=1{% if query %}&q={{ query }}{% endif %}{% if estado_filter %}&estado={{ estado_filter }}{% endif %}{% if orden %}&orden={{ orden }}{% endif %}">Â« Primera</a>
            <a href="?page={{ page_obj.previous_page_number }}{% if query %}&q={{ query }}{% endif %}{% if estado_filter %}&estado={{ estado_filter }}{% endif %}{% if orden %}&orden={{ orden }}{% endif %}">â€¹ Anterior</a>
        {% endif %}
        
        <span class="current">
            PÃ¡gina {{ page_obj.number }} de {{ page_obj.paginator.num_pages }}
        </span>
        
        {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}{% if query %}&q={{ query }}{% endif %}{% if estado_filter %}&estado={{ estado_filter }}{% endif %}{% if orden %}&orden={{ orden }}{% endif %}">Siguiente â€º</a>
            <a href="?page={{ page_obj.paginator.num_pages }}{% if query %}&q={{ query }}{% endif %}{% if estado_filter %}&estado={{ estado_filter }}{% endif %}{% if orden %}&orden={{ orden }}{% endif %}">Ãšltima Â»</a>
        {% endif %}
    </div>
    {% endif %}
    
    {% else %}
    <div class="empty-state">
        <p>No se encontraron clientes.</p>
        <a href="{% url 'clientes:cliente_create' %}" class="btn" style="margin-top: 1rem;">Crear primer cliente</a>
    </div>
    {% endif %}
</div>
{% endblock %}


